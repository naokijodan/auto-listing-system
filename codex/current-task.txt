## Task: eBayマルチアカウント対応 - Phase 3: フロントエンドUI変更

### 目的
eBayの複数アカウントを管理・選択できるUIを追加する。

### 変更対象ファイル
1. `apps/web/src/lib/api.ts` - API クライアントにcredentialId追加
2. `apps/web/src/app/settings/page.tsx` - eBayアカウント管理セクション追加
3. `apps/web/src/app/products/page.tsx` - 出品時のアカウント選択追加

---

### 1. apps/web/src/lib/api.ts の変更

#### 1a. bulkPublish に credentialId パラメータ追加

現在（389行目あたり）:
```typescript
bulkPublish: async (ids: string[], marketplace = 'JOOM') => {
    return postApi<{ success: boolean; data: { createdCount: number } }>(
      '/api/products/bulk/publish',
      { ids, marketplace }
    );
  },
```

変更後:
```typescript
bulkPublish: async (ids: string[], marketplace = 'JOOM', credentialId?: string) => {
    return postApi<{ success: boolean; data: { createdCount: number } }>(
      '/api/products/bulk/publish',
      { ids, marketplace, ...(credentialId && { credentialId }) }
    );
  },
```

---

### 2. apps/web/src/app/settings/page.tsx の変更

#### 2a. MarketplaceSettings コンポーネント内に eBayアカウント管理を追加

MarketplaceSettings 関数（346行目）の中に:

1. eBayアカウント一覧を取得するSWRフックを追加:
```typescript
const { data: ebayAccountsData, mutate: mutateAccounts } = useSWR<{ accounts: Array<{
    id: string;
    name: string;
    isActive: boolean;
    sandbox: boolean;
    tokenExpiresAt: string | null;
    isExpired: boolean;
    needsRefresh: boolean;
    createdAt: string;
  }> }>('/api/ebay/accounts', fetcher);
```

2. アカウント追加ハンドラを追加:
```typescript
const [newAccountName, setNewAccountName] = useState('');

const handleAddEbayAccount = () => {
    const accountName = newAccountName.trim() || `account-${Date.now()}`;
    window.location.href = `/api/ebay/auth?accountName=${encodeURIComponent(accountName)}`;
};

const handleDeleteEbayAccount = async (accountId: string) => {
    try {
      await fetch(`/api/ebay/accounts/${accountId}`, { method: 'DELETE' });
      mutateAccounts();
      addToast({ type: 'success', message: 'アカウントを無効化しました' });
    } catch {
      addToast({ type: 'error', message: 'アカウントの無効化に失敗しました' });
    }
};
```

3. eBay Card の CardContent 内、同期スケジュールセクション(border-t pt-4の部分)の前に、アカウント一覧セクションを追加:

```tsx
{/* eBay アカウント管理 */}
<div className="border-t pt-4 dark:border-zinc-700">
  <h4 className="mb-3 text-sm font-medium text-zinc-700 dark:text-zinc-300">接続アカウント</h4>
  {ebayAccountsData?.accounts && ebayAccountsData.accounts.length > 0 ? (
    <div className="space-y-2">
      {ebayAccountsData.accounts.map(account => (
        <div key={account.id} className="flex items-center justify-between rounded-lg bg-zinc-50 p-3 dark:bg-zinc-800">
          <div className="flex items-center gap-3">
            <span className={cn('h-2 w-2 rounded-full', account.isActive && !account.isExpired ? 'bg-emerald-500' : account.isExpired ? 'bg-amber-500' : 'bg-zinc-400')} />
            <div>
              <p className="text-sm font-medium text-zinc-900 dark:text-white">{account.name}</p>
              <p className="text-xs text-zinc-500">
                {account.isExpired ? 'トークン期限切れ' : account.isActive ? '接続済み' : '無効'}
                {account.sandbox ? ' (サンドボックス)' : ''}
              </p>
            </div>
          </div>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => handleDeleteEbayAccount(account.id)}
            className="text-red-500 hover:text-red-700"
          >
            削除
          </Button>
        </div>
      ))}
    </div>
  ) : (
    <p className="text-sm text-zinc-500">アカウントが接続されていません</p>
  )}
  <div className="mt-3 flex gap-2">
    <input
      type="text"
      placeholder="アカウント名"
      value={newAccountName}
      onChange={(e) => setNewAccountName(e.target.value)}
      className="rounded-md border border-zinc-300 px-3 py-1.5 text-sm dark:border-zinc-600 dark:bg-zinc-800"
    />
    <Button variant="outline" size="sm" onClick={handleAddEbayAccount}>
      + アカウント追加
    </Button>
  </div>
</div>
```

この追加セクションは、eBay Card内の同期スケジュールセクション（`{/* Sync Schedule */}` コメントの手前）に挿入する。

---

### 3. apps/web/src/app/products/page.tsx の変更

#### 3a. eBayアカウント選択のstateとデータフェッチを追加

コンポーネントの先頭（他のuseState宣言のあたり）に追加:
```typescript
const [selectedEbayCredentialId, setSelectedEbayCredentialId] = useState<string>('');
const { data: ebayAccountsData } = useSWR<{ accounts: Array<{ id: string; name: string; isActive: boolean }> }>(
  '/api/ebay/accounts',
  fetcher
);
const activeEbayAccounts = ebayAccountsData?.accounts?.filter(a => a.isActive) || [];
```

注意: useSWRとfetcherがまだインポートされていない場合はインポートする。既にインポートされている可能性が高い。

#### 3b. handleCreateEbayListing にcredentialIdを渡す

現在（274行目あたり）:
```typescript
const handleCreateEbayListing = useCallback(async (productId: string) => {
    setIsCreatingEbayListing(true);
    try {
      const response = await postApi('/api/ebay-listings/listings', {
        productId,
      }) as { id: string };
```

変更後:
```typescript
const handleCreateEbayListing = useCallback(async (productId: string) => {
    setIsCreatingEbayListing(true);
    try {
      const response = await postApi('/api/ebay-listings/listings', {
        productId,
        ...(selectedEbayCredentialId && { credentialId: selectedEbayCredentialId }),
      }) as { id: string };
```

useCallbackの依存配列にselectedEbayCredentialIdを追加すること。

#### 3c. eBay出品ボタンの上にアカウントセレクターを追加

eBay出品ボタン（831行目あたり `handleCreateEbayListing(selectedProduct.id)` を呼ぶボタン）の前に、アカウントセレクターを追加:

```tsx
{/* eBayアカウント選択 */}
{activeEbayAccounts.length > 1 && (
  <select
    value={selectedEbayCredentialId}
    onChange={(e) => setSelectedEbayCredentialId(e.target.value)}
    className="w-full rounded-md border border-zinc-300 px-3 py-1.5 text-sm dark:border-zinc-600 dark:bg-zinc-800"
  >
    <option value="">デフォルトアカウント</option>
    {activeEbayAccounts.map(account => (
      <option key={account.id} value={account.id}>{account.name}</option>
    ))}
  </select>
)}
```

---

### 注意事項
- 既存のUIの見た目を壊さない
- セレクターはeBayアカウントが2つ以上ある場合のみ表示（1つの場合は不要）
- shadcn/uiのSelect コンポーネントの代わりに素のHTML selectを使ってもOK（より簡潔）
- Tailwind CSSのクラス名を使用（既存のスタイルに合わせる）
- lucide-react のアイコンはすでにインポートされているものを使う
- テストファイルは変更しない
- fetcherとuseSWRが既にインポートされている場合は追加しない
