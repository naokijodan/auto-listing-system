# RAKUDA 引き継ぎ書
## 2026年2月14日 Phase 108-113

---

## サマリー
**6 Phase完了**: eBay管理機能群（メッセージ/注文/返品/フィードバック/分析/一括編集）を実装

---

## 完了機能一覧

| Phase | 機能名 | APIファイル | UIページ | 主要エンドポイント | 依存（ジョブ/モデル） |
|-------|--------|------------|----------|-------------------|---------------------|
| 108 | メッセージ管理 | `ebay-messages.ts` | `/ebay/messages` | `/dashboard`, `/send`, `/:id/retry` | CustomerMessage, MessageTemplate |
| 109 | 注文管理強化 | `ebay-orders.ts` | `/ebay/orders` | `/dashboard`, `/:id/ship`, `/:id/cancel` | Order, Sale, `ebay-ship-order` |
| 110 | 返品・返金管理 | `ebay-returns.ts` | `/ebay/returns` | `/dashboard`, `/:id/process` | ReturnRequest, `ebay-process-return` |
| 111 | フィードバック管理 | `ebay-feedback.ts` | `/ebay/feedback` | `/dashboard`, `/leave`, `/:id/respond` | Feedback, `ebay-leave-feedback` |
| 112 | 分析・レポート | `ebay-analytics.ts` | `/ebay/analytics` | `/dashboard`, `/sales-trend`, `/profit-analysis` | Order, Sale, Listing |
| 113 | バルクエディター | `ebay-bulk-editor.ts` | `/ebay/bulk-editor` | `/edit`, `/status`, `/delete` | Listing, `ebay-bulk-update` |

---

## アーキテクチャ図

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Next.js   │────▶│  Express.js │────▶│   BullMQ    │────▶│  eBay API   │
│   (Web UI)  │     │    (API)    │     │  (Worker)   │     │  (External) │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
                           │                   │
                           ▼                   ▼
                    ┌─────────────┐     ┌─────────────┐
                    │   Prisma    │     │    Redis    │
                    │ (PostgreSQL)│     │   (Queue)   │
                    └─────────────┘     └─────────────┘
```

### 同期/非同期の境界
| 処理 | 種別 | 説明 |
|------|------|------|
| CRUD操作 | **同期** | 一覧・詳細・作成・更新（即時レスポンス） |
| eBay API連携 | **非同期** | 発送通知、キャンセル、フィードバック送信 → BullMQジョブ |
| 一括編集 | **非同期** | 大量更新時はジョブキュー経由でeBay同期 |

---

## 次回優先度

### 推奨: Phase 114（eBay競合分析）

**理由**:
1. **Phase 112との相乗効果**: 競合価格の可視化が既存の分析・レポート機能の価値を増幅
2. **価格戦略の強化**: バルクエディター（Phase 113）と組み合わせて競争力のある価格設定が可能
3. **データ基盤の活用**: 既存のSale/Listingモデルを拡張して競合データを蓄積

### 代替候補
- Phase 115: eBay自動価格調整（競合分析の次に実装すると効果的）
- Phase 116: eBayスケジュール出品

---

## 技術的注意点

### BullMQ関連
- **リトライ対策**: 各ジョブは `attempts: 3` で設定済み
- **重複実行対策**: eBay APIのidempotencyキーは未実装（将来課題）
- **優先度**: 発送通知は `priority: 1`（最優先）

### Prismaスキーマ拡張候補
- `Competitor` モデル（Phase 114で必要）
- `PriceHistory` モデル（価格変動追跡用）
- `ScheduledListing` モデル（Phase 116で必要）

### 既知の制限
- メッセージ送信は現在PENDINGとして保存（実際のeBay API送信はワーカー実装待ち）
- フィードバック同期は手動トリガー（自動同期スケジューラ未実装）

---

## ファイル構成

```
apps/api/src/routes/
├── ebay-messages.ts      # Phase 108
├── ebay-orders.ts        # Phase 109
├── ebay-returns.ts       # Phase 110
├── ebay-feedback.ts      # Phase 111
├── ebay-analytics.ts     # Phase 112
└── ebay-bulk-editor.ts   # Phase 113

apps/web/src/app/ebay/
├── messages/page.tsx     # Phase 108
├── orders/page.tsx       # Phase 109
├── returns/page.tsx      # Phase 110
├── feedback/page.tsx     # Phase 111
├── analytics/page.tsx    # Phase 112
└── bulk-editor/page.tsx  # Phase 113
```

---

## 関連資料
- `NEXT_SESSION.md` - 次回セッション情報
- `開発ログ/rakuda_phase108_2026-02-14.md` 〜 `phase113_2026-02-14.md`
- Prismaスキーマ: `packages/database/prisma/schema.prisma`

---

## 引き継ぎ文（コピペ用）

```
Phase 108-113完了。eBay管理機能（メッセージ/注文/返品/フィードバック/分析/一括編集）を実装。
全機能にダッシュボード・一覧・詳細・操作UIあり。eBay API連携はBullMQで非同期処理。
次回はPhase 114（競合分析）から。NEXT_SESSION.md参照。
```
