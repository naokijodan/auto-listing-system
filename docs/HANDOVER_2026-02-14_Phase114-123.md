# RAKUDA 引き継ぎ書
## 2026年2月14日 Phase 114-123

---

## サマリー
**10 Phase完了**: eBay高度管理機能群（競合分析/自動価格/スケジュール/在庫補充/AI最適化/A/Bテスト/多言語/プロモーション/レポート/広告）

---

## 完了機能一覧（業務フロー順）

| Phase | 機能名 | APIファイル | UIページ | 主要機能 | 依存 |
|-------|--------|------------|----------|----------|------|
| 114 | 競合分析 | `ebay-competitors.ts` | `/ebay/competitors` | 競合URL追跡、価格アラート、履歴 | CompetitorListing※ |
| 115 | 自動価格調整 | `ebay-auto-pricing.ts` | `/ebay/auto-pricing` | ルール管理、ドライラン、実行 | PricingRule, PriceChangeLog |
| 116 | スケジュール出品 | `ebay-scheduled.ts` | `/ebay/scheduled` | 予約作成、カレンダー、一括 | ScheduledListing |
| 117 | 在庫自動補充 | `ebay-auto-restock.ts` | `/ebay/auto-restock` | 低在庫アラート、発注管理 | RestockRule/Log/Order |
| 118 | 出品最適化 | `ebay-optimization.ts` | `/ebay/optimization` | AIタイトル改善、キーワード提案 | ListingOptimization, OpenAI |
| 119 | A/Bテスト | `ebay-ab-tests.ts` | `/ebay/ab-tests` | 最適化からテスト作成、統計的有意差判定 | ABTest, ABTestVariant |
| 120 | 多言語対応 | `ebay-multilingual.ts` | `/ebay/multilingual` | 12言語翻訳、SEO最適化 | marketplaceData.translations |
| 121 | プロモーション | `ebay-promotions.ts` | `/ebay/promotions` | セール、クーポン、テンプレート | marketplaceData.promotion |
| 122 | レポート生成 | `ebay-reports.ts` | `/ebay/reports` | 7種レポート、CSV出力、スケジュール | - |
| 123 | 広告連携 | `ebay-ads.ts` | `/ebay/ads` | Promoted Listings、ROAS分析 | marketplaceData.ads |

※ Phase 114は既存のCompetitorTrackerモデルを活用

---

## Phase間の連携関係

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            eBay管理画面                                  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
        ┌───────────┬───────────────┼───────────────┬───────────────┐
        ▼           ▼               ▼               ▼               ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│  Phase 114  │ │  Phase 116  │ │  Phase 117  │ │  Phase 120  │ │  Phase 121  │
│   競合分析  │ │ スケジュール │ │  在庫補充   │ │   多言語    │ │ プロモーション│
│ 価格追跡    │ │  予約出品   │ │ 低在庫管理  │ │ 12言語翻訳  │ │ セール/クーポン│
└─────┬───────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
      │
      ▼ 競合価格データ
┌─────────────┐
│  Phase 115  │
│ 自動価格調整 │◀──────────┐
│ ルールベース │            │
└─────┬───────┘            │
      │                    │ 効果検証結果
      ▼ 価格変更          │
┌─────────────┐            │
│  Phase 118  │────────────┤
│  AI最適化   │            │
│タイトル改善 │            │
└─────┬───────┘            │
      │                    │
      ▼ 最適化提案         │
┌─────────────┐────────────┘
│  Phase 119  │
│  A/Bテスト  │
│ 統計的検証  │
└─────────────┘
      │
      ▼ パフォーマンスデータ
┌─────────────┐     ┌─────────────┐
│  Phase 122  │     │  Phase 123  │
│ レポート生成 │◀───▶│  広告連携   │
│ 分析・出力  │     │ ROAS最適化  │
└─────────────┘     └─────────────┘
```

### 重要な連携

#### Phase 118 → 119（AI最適化 → A/Bテスト）
1. Phase 118でAI最適化提案を生成
2. Phase 119の`/from-optimization`で提案をA/Bテストに変換
3. 統計的有意差を検証後、勝者を採用

#### Phase 119 → 122（A/Bテスト → レポート）
- A/Bテスト結果がレポート（`AB_TEST_RESULTS`タイプ）として出力可能

#### Phase 120 ⇔ 121（多言語 ⇔ プロモーション）
- 多言語で翻訳したリスティングにプロモーションを適用可能

---

## Phase 119-123 詳細

### Phase 119: A/Bテスト
| 項目 | 詳細 |
|------|------|
| テスト対象 | タイトル、説明、価格、画像 |
| 統計手法 | Z検定、95%信頼区間 |
| 判定条件 | `p < 0.05` で有意差あり |
| 自動採用 | 勝者バリアントを本番適用 |

### Phase 120: 多言語対応
| 言語 | コード | 対象市場 |
|------|--------|----------|
| English | en | US, UK, AU |
| German | de | DE, AT, CH |
| French | fr | FR, CA, BE |
| Spanish | es | ES, MX |
| Italian | it | IT |
| Japanese | ja | JP |
| Chinese | zh | CN, TW, HK |
| Korean | ko | KR |
| Portuguese | pt | BR, PT |
| Dutch | nl | NL, BE |
| Polish | pl | PL |
| Russian | ru | RU |

### Phase 121: プロモーション
| タイプ | 名前 | 説明 |
|--------|------|------|
| `MARKDOWN_SALE` | 値下げセール | 固定額/パーセント割引 |
| `ORDER_DISCOUNT` | 注文割引 | 金額条件で割引 |
| `VOLUME_PRICING` | ボリュームディスカウント | 複数購入割引 |
| `SHIPPING_DISCOUNT` | 送料割引 | 条件付き送料無料 |
| `COUPON` | クーポン | コード入力で適用 |
| `CODELESS_COUPON` | コードレスクーポン | 自動適用クーポン |

### Phase 122: レポート生成
| タイプ | 名前 | 内容 |
|--------|------|------|
| `SALES_SUMMARY` | 売上サマリー | 売上・利益の概要 |
| `LISTING_PERFORMANCE` | 出品パフォーマンス | 閲覧数・コンバージョン率 |
| `INVENTORY_STATUS` | 在庫状況 | 在庫レベル・補充推奨 |
| `COMPETITOR_ANALYSIS` | 競合分析 | 競合価格比較 |
| `PROMOTION_EFFECTIVENESS` | プロモーション効果 | セール・クーポン効果 |
| `AB_TEST_RESULTS` | A/Bテスト結果 | テスト結果サマリー |
| `MULTILINGUAL_COVERAGE` | 多言語カバレッジ | 翻訳状況 |

出力形式: JSON, CSV（PDF/Excelは将来実装）

### Phase 123: 広告連携
| キャンペーンタイプ | 説明 |
|-------------------|------|
| `PROMOTED_LISTINGS_STANDARD` | 成果報酬型（売れたら課金） |
| `PROMOTED_LISTINGS_ADVANCED` | CPC型（クリック課金） |
| `PROMOTED_LISTINGS_EXPRESS` | 簡易設定型 |

| 入札戦略 | 説明 |
|---------|------|
| `FIXED` | 手動で入札額を設定 |
| `DYNAMIC` | eBayが自動最適化 |
| `SUGGESTED` | eBay推奨額を使用 |

主要KPI: ROAS, CPC, CTR, コンバージョン率

---

## データ保存場所

### 新規Prismaモデル（Phase 114-118）
| モデル | Phase | 用途 |
|--------|-------|------|
| `ScheduledListing` | 116 | スケジュール出品 |
| `RestockRule` | 117 | 補充ルール |
| `RestockLog` | 117 | 補充履歴 |
| `RestockOrder` | 117 | 発注管理 |
| `ListingOptimization` | 118 | 最適化提案 |
| `ABTest`, `ABTestVariant` | 119 | A/Bテスト（既存モデル活用） |

### listing.marketplaceData内（Phase 120-123）
| フィールド | Phase | 内容 |
|-----------|-------|------|
| `translations` | 120 | 各言語の翻訳（title, description, keywords） |
| `promotion` | 121 | プロモーション設定（type, discount, period） |
| `ads` | 123 | 広告データ（campaign, metrics） |

---

## ファイル構成

```
apps/api/src/routes/
├── ebay-competitors.ts      # Phase 114
├── ebay-auto-pricing.ts     # Phase 115
├── ebay-scheduled.ts        # Phase 116
├── ebay-auto-restock.ts     # Phase 117
├── ebay-optimization.ts     # Phase 118
├── ebay-ab-tests.ts         # Phase 119
├── ebay-multilingual.ts     # Phase 120
├── ebay-promotions.ts       # Phase 121
├── ebay-reports.ts          # Phase 122
└── ebay-ads.ts              # Phase 123

apps/web/src/app/ebay/
├── competitors/page.tsx     # Phase 114
├── auto-pricing/page.tsx    # Phase 115
├── scheduled/page.tsx       # Phase 116
├── auto-restock/page.tsx    # Phase 117
├── optimization/page.tsx    # Phase 118
├── ab-tests/page.tsx        # Phase 119
├── multilingual/page.tsx    # Phase 120
├── promotions/page.tsx      # Phase 121
├── reports/page.tsx         # Phase 122
└── ads/page.tsx             # Phase 123
```

---

## コミット履歴

| コミット | 内容 |
|---------|------|
| `0aa810b` | Phase 114 eBay競合分析 |
| `6f5cb85` | Phase 115 eBay自動価格調整 |
| `db12b5d` | Phase 116-118 スケジュール/在庫補充/最適化 |
| `123941f` | Phase 119 eBay A/Bテスト |
| `0259c62` | Phase 120-121 多言語対応/プロモーション連携 |
| `336d43f` | Phase 122-123 レポート自動生成/広告連携 |

---

## 引き継ぎ文（コピペ用）

```
Phase 114-123完了。eBay高度管理機能群を実装。
- 競合分析: 競合URL追跡、価格アラート
- 自動価格調整: ルールベース、競合追従、ドライラン
- スケジュール出品: 予約出品、カレンダービュー
- 在庫自動補充: 低在庫アラート、発注管理
- 出品最適化: AIタイトル・説明改善（OpenAI GPT-4o）
- A/Bテスト: 最適化提案の効果検証、統計的有意差判定
- 多言語対応: 12言語翻訳、SEO最適化
- プロモーション: セール、クーポン、テンプレート
- レポート生成: 7種レポート、CSV出力、スケジュール
- 広告連携: Promoted Listings、ROAS/CPC/CTR分析

Phase 118→119の連携が重要（AI最適化→A/Bテスト→効果検証）。
```

---

## 次回推奨Phase

### 候補

| Phase | 機能 | 優先度 | 理由 |
|-------|------|--------|------|
| 124 | eBay返品・返金管理 | 高 | 運用上必須 |
| 125 | eBayメッセージ自動応答 | 中 | 顧客対応効率化 |
| 126 | eBay評価分析・改善 | 中 | セラー評価向上 |
| 127 | eBayクロスボーダー物流 | 低 | 物流最適化 |

**推奨: Phase 124（返品・返金管理）**
- 売上が増えると返品対応が増加
- 自動化で運用負荷を軽減
